# טורניר פינג פונג

מערכת לניהול טורנירי פינג פונג עם אפשרות לניהול שחקנים, טורנירים ופרסים.

## התקנה

```bash
# התקנת תלויות
npm install

# יצירת מסד נתונים והפעלת מיגרציות
npm run db:migrate:safe

# הפעלה בסביבת פיתוח
npm run dev
```

## ניהול מסד הנתונים

המערכת משתמשת ב-Prisma ORM לניהול המודלים ומיגרציות מסד הנתונים.

### פקודות מיגרציה

- `npm run db:migrate:safe` - הפעלת מיגרציות עם בדיקות בטיחות (מומלץ בסביבת פיתוח)
- `npm run db:migrate` - הפעלת מיגרציות באופן ישיר
- `npm run db:migrate:force` - הפעלת מיגרציות בכוח (ללא בדיקות)
- `npm run db:verify` - בדיקת התאמה בין מודל Prisma למסד הנתונים

## פתרון בעיות ידועות

### בעיית Timeout במיגרציות Prisma בעת deployment ב-Vercel

אם אתם נתקלים בשגיאת timeout בעת deployment ב-Vercel, הבעיה נובעת מניסיון להפעיל מיגרציות על מסד נתונים Neon בזמן ה-build.
הפתרון שיישמנו:

1. עדכנו את הסקריפט `prisma/safe-migrate.js` כדי לדלג על ביצוע מיגרציות בסביבת Vercel
2. הוספנו פקודה ייעודית `npm run db:migrate:force` להפעלת מיגרציות ידנית

**לפני כל deployment ב-Vercel:**
1. הפעילו את המיגרציות באופן ידני על מסד הנתונים שלכם:
   ```bash
   npm run db:migrate:force
   ```
2. לאחר מכן בצעו deployment ב-Vercel כרגיל

הסקריפט המעודכן יזהה אוטומטית שהוא רץ בסביבת Vercel ולא ינסה להפעיל מיגרציות בזמן ה-build, מה שימנע את בעיית ה-timeout.

## סוגיות אימות

המערכת משתמשת בטוקנים לאימות מנהלים. עם הזמן התפתחו שתי שיטות טוקנים במערכת:
1. טוקנים עם תחילית `admin-`
2. טוקנים בפורמט UUID רגיל

המערכת תומכת כעת בשני הפורמטים לאחורה.

## תכונות עיקריות

- ניהול טורנירים
- ניהול שחקנים
- ניהול פרסים כספיים
- אימות מנהלים
- יצירת מערכי משחקים 